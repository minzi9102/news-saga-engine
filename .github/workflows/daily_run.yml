name: Daily News Saga Run

on:
  # 1. å®šæ—¶è§¦å‘ (Cron è¯­æ³•)
  schedule:
    # GitHub ä½¿ç”¨ UTC æ—¶é—´ã€‚åŒ—äº¬æ—¶é—´ 20:00 = UTC 12:00
    # å»ºè®®è®¾ç½®ä¸º UTC 12:30 (åŒ—äº¬ 20:30)ï¼Œç¡®ä¿æ–°é—»è”æ’­å®Œå…¨ç»“æŸä¸”å®˜ç½‘å·²æ›´æ–°
    - cron: '30 12 * * *'
  
  # 2. å…è®¸æ‰‹åŠ¨è§¦å‘ (æ–¹ä¾¿æµ‹è¯•)
  workflow_dispatch:

permissions:
  contents: write  # èµ‹äºˆå†™æƒé™ï¼Œä»¥ä¾¿å°†ç”Ÿæˆçš„ JSON/Markdown æ¨é€å›ä»“åº“

jobs:
  run-saga:
    runs-on: ubuntu-latest
    
    steps:
    # A. æ‹‰å–ä»£ç 
    - name: Checkout code
      uses: actions/checkout@v4

    # B. è®¾ç½® Python ç¯å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip' # å¯ç”¨ç¼“å­˜ï¼ŒåŠ é€Ÿå®‰è£…

    # C. å®‰è£…ä¾èµ–
    - name: Install Dependencies
      run: |
        pip install -r requirements.txt
        # Crawl4AI ä¾èµ– Playwrightï¼Œå¿…é¡»å®‰è£…æµè§ˆå™¨å†…æ ¸
        python -m playwright install --with-deps chromium

    # D. è¿è¡Œå¼•æ“ (æ³¨å…¥ Secrets)
    - name: Run News Saga Engine
      env:
        LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
        LLM_BASE_URL: ${{ secrets.LLM_BASE_URL }}
        LLM_MODEL: ${{ secrets.LLM_MODEL }}
      run: |
        python main.py

    # E. æäº¤å¹¶æ¨é€ç»“æœ (å…³é”®æ­¥éª¤)
    # å¦‚æœ data/ æˆ– README.md æœ‰å˜åŒ–ï¼Œå°±æäº¤ï¼›å¦åˆ™è·³è¿‡
    - name: Commit and Push changes
      run: |
        git config --global user.name "SagaBot"
        git config --global user.email "actions@github.com"
        
        # æ·»åŠ æ‰€æœ‰ç”Ÿæˆçš„æ•°æ®
        git add README.md data/
        
        # å°è¯•æäº¤ï¼Œå¦‚æœæ— å˜åŒ–(git commitæŠ¥é”™)åˆ™å¿½ç•¥
        git commit -m "ğŸš€ Auto-update: Daily Saga [$(date +'%Y-%m-%d')]" || exit 0
        
        # æ¨é€å›ä»“åº“
        git push